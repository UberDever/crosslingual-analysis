package main_test

import (
	"testing"
	translate "translate-json"
	ss "translate/shared"
)

const MAIN_PATH = ss.ANCHOR_PATH + "evaluation/Example 5/weather.json"

func TestSmoke(t *testing.T) {
	ss.RunAsCommand([]string{"_", ""}, translate.Run)
}

func TestEvaluationRegression(t *testing.T) {
	expected := `{"Usage":[{"id":2,"identifier":{"name":"coord","path":"weather.json","start":6,"length":13},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":6,"identifier":{"name":"lon","path":"weather.json","start":25,"length":30},"usage":"declaration","scope":{"index":3,"name":"_"}},{"id":10,"identifier":{"name":"lat","path":"weather.json","start":37,"length":52},"usage":"declaration","scope":{"index":3,"name":"_"}},{"id":14,"identifier":{"name":"weather","path":"weather.json","start":65,"length":80},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":17,"identifier":{"name":"0","path":"weather.json","start":92,"length":93},"usage":"declaration","scope":{"index":15,"name":"_"}},{"id":21,"identifier":{"name":"id","path":"weather.json","start":106,"length":110},"usage":"declaration","scope":{"index":18,"name":"_"}},{"id":25,"identifier":{"name":"main","path":"weather.json","start":115,"length":135},"usage":"declaration","scope":{"index":18,"name":"_"}},{"id":29,"identifier":{"name":"description","path":"weather.json","start":143,"length":170},"usage":"declaration","scope":{"index":18,"name":"_"}},{"id":33,"identifier":{"name":"icon","path":"weather.json","start":187,"length":207},"usage":"declaration","scope":{"index":18,"name":"_"}},{"id":37,"identifier":{"name":"base","path":"weather.json","start":230,"length":242},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":41,"identifier":{"name":"main","path":"weather.json","start":254,"length":266},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":45,"identifier":{"name":"temp","path":"weather.json","start":278,"length":284},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":49,"identifier":{"name":"feels_like","path":"weather.json","start":292,"length":314},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":53,"identifier":{"name":"temp_min","path":"weather.json","start":322,"length":342},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":57,"identifier":{"name":"temp_max","path":"weather.json","start":350,"length":370},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":61,"identifier":{"name":"pressure","path":"weather.json","start":378,"length":398},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":65,"identifier":{"name":"humidity","path":"weather.json","start":404,"length":424},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":69,"identifier":{"name":"sea_level","path":"weather.json","start":428,"length":449},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":73,"identifier":{"name":"grnd_level","path":"weather.json","start":455,"length":477},"usage":"declaration","scope":{"index":42,"name":"_"}},{"id":77,"identifier":{"name":"visibility","path":"weather.json","start":488,"length":506},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":81,"identifier":{"name":"wind","path":"weather.json","start":513,"length":525},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":85,"identifier":{"name":"speed","path":"weather.json","start":537,"length":544},"usage":"declaration","scope":{"index":82,"name":"_"}},{"id":89,"identifier":{"name":"deg","path":"weather.json","start":550,"length":565},"usage":"declaration","scope":{"index":82,"name":"_"}},{"id":93,"identifier":{"name":"gust","path":"weather.json","start":570,"length":586},"usage":"declaration","scope":{"index":82,"name":"_"}},{"id":97,"identifier":{"name":"rain","path":"weather.json","start":598,"length":610},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":101,"identifier":{"name":"1h","path":"weather.json","start":622,"length":626},"usage":"declaration","scope":{"index":98,"name":"_"}},{"id":105,"identifier":{"name":"clouds","path":"weather.json","start":638,"length":652},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":109,"identifier":{"name":"all","path":"weather.json","start":664,"length":669},"usage":"declaration","scope":{"index":106,"name":"_"}},{"id":113,"identifier":{"name":"dt","path":"weather.json","start":680,"length":690},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":117,"identifier":{"name":"sys","path":"weather.json","start":702,"length":713},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":121,"identifier":{"name":"type","path":"weather.json","start":725,"length":731},"usage":"declaration","scope":{"index":118,"name":"_"}},{"id":125,"identifier":{"name":"id","path":"weather.json","start":734,"length":748},"usage":"declaration","scope":{"index":118,"name":"_"}},{"id":129,"identifier":{"name":"country","path":"weather.json","start":757,"length":776},"usage":"declaration","scope":{"index":118,"name":"_"}},{"id":133,"identifier":{"name":"sunrise","path":"weather.json","start":782,"length":801},"usage":"declaration","scope":{"index":118,"name":"_"}},{"id":137,"identifier":{"name":"sunset","path":"weather.json","start":813,"length":831},"usage":"declaration","scope":{"index":118,"name":"_"}},{"id":141,"identifier":{"name":"timezone","path":"weather.json","start":849,"length":865},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":145,"identifier":{"name":"id","path":"weather.json","start":871,"length":881},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":149,"identifier":{"name":"name","path":"weather.json","start":890,"length":902},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":153,"identifier":{"name":"cod","path":"weather.json","start":911,"length":922},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":157,"identifier":{"name":"undefined","path":"weather.json","start":927,"length":944},"usage":"declaration","scope":{"index":0,"name":"_"}},{"id":161,"identifier":{"name":"true","path":"weather.json","start":950,"length":962},"usage":"declaration","scope":{"index":0,"name":"_"}}],"DirectEdge":null,"AssociationKnown":[{"id":5,"declaration":{"name":"coord","path":"weather.json","start":6,"length":13},"scope":{"index":3,"name":"_"}},{"id":16,"declaration":{"name":"weather","path":"weather.json","start":65,"length":80},"scope":{"index":15,"name":"_"}},{"id":20,"declaration":{"name":"0","path":"weather.json","start":92,"length":93},"scope":{"index":18,"name":"_"}},{"id":44,"declaration":{"name":"main","path":"weather.json","start":254,"length":266},"scope":{"index":42,"name":"_"}},{"id":84,"declaration":{"name":"wind","path":"weather.json","start":513,"length":525},"scope":{"index":82,"name":"_"}},{"id":100,"declaration":{"name":"rain","path":"weather.json","start":598,"length":610},"scope":{"index":98,"name":"_"}},{"id":108,"declaration":{"name":"clouds","path":"weather.json","start":638,"length":652},"scope":{"index":106,"name":"_"}},{"id":120,"declaration":{"name":"sys","path":"weather.json","start":702,"length":713},"scope":{"index":118,"name":"_"}}],"NominalEdge":null,"Resolution":null,"Uniqueness":[{"id":1,"names":{"collection":"declared","scope":{"index":0,"name":"_"}}},{"id":4,"names":{"collection":"declared","scope":{"index":3,"name":"_"}}},{"id":19,"names":{"collection":"declared","scope":{"index":18,"name":"_"}}},{"id":43,"names":{"collection":"declared","scope":{"index":42,"name":"_"}}},{"id":83,"names":{"collection":"declared","scope":{"index":82,"name":"_"}}},{"id":99,"names":{"collection":"declared","scope":{"index":98,"name":"_"}}},{"id":107,"names":{"collection":"declared","scope":{"index":106,"name":"_"}}},{"id":119,"names":{"collection":"declared","scope":{"index":118,"name":"_"}}}],"Subset":null,"AssociationUnknown":null,"TypeDeclKnown":[{"id":8,"declaration":{"name":"lon","path":"weather.json","start":25,"length":30},"variable":{"index":7,"name":"tau"}},{"id":12,"declaration":{"name":"lat","path":"weather.json","start":37,"length":52},"variable":{"index":11,"name":"tau"}},{"id":23,"declaration":{"name":"id","path":"weather.json","start":106,"length":110},"variable":{"index":22,"name":"tau"}},{"id":27,"declaration":{"name":"main","path":"weather.json","start":115,"length":135},"variable":{"index":26,"name":"tau"}},{"id":31,"declaration":{"name":"description","path":"weather.json","start":143,"length":170},"variable":{"index":30,"name":"tau"}},{"id":35,"declaration":{"name":"icon","path":"weather.json","start":187,"length":207},"variable":{"index":34,"name":"tau"}},{"id":39,"declaration":{"name":"base","path":"weather.json","start":230,"length":242},"variable":{"index":38,"name":"tau"}},{"id":47,"declaration":{"name":"temp","path":"weather.json","start":278,"length":284},"variable":{"index":46,"name":"tau"}},{"id":51,"declaration":{"name":"feels_like","path":"weather.json","start":292,"length":314},"variable":{"index":50,"name":"tau"}},{"id":55,"declaration":{"name":"temp_min","path":"weather.json","start":322,"length":342},"variable":{"index":54,"name":"tau"}},{"id":59,"declaration":{"name":"temp_max","path":"weather.json","start":350,"length":370},"variable":{"index":58,"name":"tau"}},{"id":63,"declaration":{"name":"pressure","path":"weather.json","start":378,"length":398},"variable":{"index":62,"name":"tau"}},{"id":67,"declaration":{"name":"humidity","path":"weather.json","start":404,"length":424},"variable":{"index":66,"name":"tau"}},{"id":71,"declaration":{"name":"sea_level","path":"weather.json","start":428,"length":449},"variable":{"index":70,"name":"tau"}},{"id":75,"declaration":{"name":"grnd_level","path":"weather.json","start":455,"length":477},"variable":{"index":74,"name":"tau"}},{"id":79,"declaration":{"name":"visibility","path":"weather.json","start":488,"length":506},"variable":{"index":78,"name":"tau"}},{"id":87,"declaration":{"name":"speed","path":"weather.json","start":537,"length":544},"variable":{"index":86,"name":"tau"}},{"id":91,"declaration":{"name":"deg","path":"weather.json","start":550,"length":565},"variable":{"index":90,"name":"tau"}},{"id":95,"declaration":{"name":"gust","path":"weather.json","start":570,"length":586},"variable":{"index":94,"name":"tau"}},{"id":103,"declaration":{"name":"1h","path":"weather.json","start":622,"length":626},"variable":{"index":102,"name":"tau"}},{"id":111,"declaration":{"name":"all","path":"weather.json","start":664,"length":669},"variable":{"index":110,"name":"tau"}},{"id":115,"declaration":{"name":"dt","path":"weather.json","start":680,"length":690},"variable":{"index":114,"name":"tau"}},{"id":123,"declaration":{"name":"type","path":"weather.json","start":725,"length":731},"variable":{"index":122,"name":"tau"}},{"id":127,"declaration":{"name":"id","path":"weather.json","start":734,"length":748},"variable":{"index":126,"name":"tau"}},{"id":131,"declaration":{"name":"country","path":"weather.json","start":757,"length":776},"variable":{"index":130,"name":"tau"}},{"id":135,"declaration":{"name":"sunrise","path":"weather.json","start":782,"length":801},"variable":{"index":134,"name":"tau"}},{"id":139,"declaration":{"name":"sunset","path":"weather.json","start":813,"length":831},"variable":{"index":138,"name":"tau"}},{"id":143,"declaration":{"name":"timezone","path":"weather.json","start":849,"length":865},"variable":{"index":142,"name":"tau"}},{"id":147,"declaration":{"name":"id","path":"weather.json","start":871,"length":881},"variable":{"index":146,"name":"tau"}},{"id":151,"declaration":{"name":"name","path":"weather.json","start":890,"length":902},"variable":{"index":150,"name":"tau"}},{"id":155,"declaration":{"name":"cod","path":"weather.json","start":911,"length":922},"variable":{"index":154,"name":"tau"}},{"id":159,"declaration":{"name":"undefined","path":"weather.json","start":927,"length":944},"variable":{"index":158,"name":"tau"}},{"id":163,"declaration":{"name":"true","path":"weather.json","start":950,"length":962},"variable":{"index":162,"name":"tau"}}],"TypeDeclUnknown":null,"EqualKnown":[{"id":9,"t1":{"index":7,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":13,"t1":{"index":11,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":24,"t1":{"index":22,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":28,"t1":{"index":26,"name":"tau"},"t2":{"tag":"ground","name":"String"}},{"id":32,"t1":{"index":30,"name":"tau"},"t2":{"tag":"ground","name":"String"}},{"id":36,"t1":{"index":34,"name":"tau"},"t2":{"tag":"ground","name":"String"}},{"id":40,"t1":{"index":38,"name":"tau"},"t2":{"tag":"ground","name":"String"}},{"id":48,"t1":{"index":46,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":52,"t1":{"index":50,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":56,"t1":{"index":54,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":60,"t1":{"index":58,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":64,"t1":{"index":62,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":68,"t1":{"index":66,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":72,"t1":{"index":70,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":76,"t1":{"index":74,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":80,"t1":{"index":78,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":88,"t1":{"index":86,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":92,"t1":{"index":90,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":96,"t1":{"index":94,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":104,"t1":{"index":102,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":112,"t1":{"index":110,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":116,"t1":{"index":114,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":124,"t1":{"index":122,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":128,"t1":{"index":126,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":132,"t1":{"index":130,"name":"tau"},"t2":{"tag":"ground","name":"String"}},{"id":136,"t1":{"index":134,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":140,"t1":{"index":138,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":144,"t1":{"index":142,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":148,"t1":{"index":146,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":152,"t1":{"index":150,"name":"tau"},"t2":{"tag":"ground","name":"String"}},{"id":156,"t1":{"index":154,"name":"tau"},"t2":{"tag":"ground","name":"Numeric"}},{"id":160,"t1":{"index":158,"name":"tau"},"t2":{"tag":"ground","name":"Top"}},{"id":164,"t1":{"index":162,"name":"tau"},"t2":{"tag":"ground","name":"Bool"}}],"EqualUnknown":null}`

	got, err := ss.ExtractConstraintsFromFile(MAIN_PATH, translate.Run)
	if err != nil {
		t.Fatal(err)
	}
	if err := ss.CompareJsonOutput(expected, got); err != nil {
		t.Fatal(err)
	}
}
